{"version":3,"sources":["class/generator.js"],"names":["Generator","config","_recipient","recipient","_emitter","emitter","_total_exc_taxes","_total_taxes","_total_inc_taxes","_article","hydrate","global","_itemsToHydrate","article","hasOwnProperty","Error","isNumeric","tax","price","qt","Number","isInteger","obj","logo","header_date","date","table_information","__","phrase","locale","lang","table_description","table_tax","table_quantity","table_price_without_taxes","table_price_without_taxes_unit","table_note","table_total_without_taxes","table_total_taxes","table_total_with_taxes","fromto_phone","fromto_mail","footer","getFooter","emitter_name","name","emitter_street_number","street_number","emitter_street_name","street_name","emitter_zip_code","zip_code","emitter_city","city","emitter_country","country","emitter_phone","phone","emitter_mail","mail","recipient_company","company_name","recipient_first_name","first_name","recipient_last_name","last_name","recipient_street_number","recipient_street_name","recipient_zip_code","recipient_city","recipient_country","recipient_phone","recipient_mail","articles","table_total_without_taxes_value","formatOutputNumber","total_exc_taxes","table_total_taxes_value","total_taxes","table_total_with_taxes_value","total_inc_taxes","template_configuration","_templateConfiguration","moment","keys","template","filename","order_template","invoice_template","compiled","compileFile","resolve","invoice_header_title","invoice_header_subject","invoice_header_reference","invoice_header_reference_value","getReferenceFromPattern","invoice_header_date","table_note_content","invoice_note","note","Object","assign","toHTML","_toHTML","toPDF","_toPDF","_preCompileCommonTranslations","order_header_title","order_header_subject","order_header_reference","order_header_reference_value","order_header_date","order_note","en","fr","type","includes","reference","setReferenceFromPattern","order_reference_pattern","invoice_reference_pattern","pattern","tmp","split","slice","output","item","endsWith","startsWith","replace","format","id","test","_id","pad","length","html","_compile","getOrder","getInvoice","toFile","filepath","_toFileFromHTML","pdf","create","_toFileFromPDF","toBuffer","_toBufferFromPDF","toStream","_toStreamFromPDF","content","Promise","reject","writeFile","err","res","buffer","console","error","stream","pipe","createWriteStream","template_rows_per_page","templateConfig","rows_in_first_page","rows_per_pages","rows_in_last_page","nbArticles","loop","loop_table","_template","value","_lang","toLowerCase","_order_reference_pattern","_invoice_reference_pattern","_reference","_logo","_order_template","_invoice_template","_order_note","_invoice_note","_footer","_date_format","_date","date_format","isValid","Array","isArray","i","_checkArticle","total_product_without_taxes","total_product_taxes","round","total_product_with_taxes","concat"],"mappings":"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","file":"generator.js","sourcesContent":["import Common from './common'\nimport Recipient from './recipient'\nimport Emitter from './emitter'\nimport pug from 'pug'\nimport path from 'path'\nimport i18n from '../lib/i18n'\nimport fs from 'fs'\nimport moment from 'moment'\nimport htmlToPdf from 'html-pdf'\n\nexport default class Generator extends Common {\n\n  constructor(config) {\n    super()\n    this._recipient = (config.recipient) ? new Recipient(config.recipient) : new Recipient()\n    this._emitter = (config.emitter) ? new Emitter(config.emitter) : new Emitter()\n    this._total_exc_taxes = 0\n    this._total_taxes = 0\n    this._total_inc_taxes = 0\n    this._article = []\n    this.hydrate(config.global, this._itemsToHydrate())\n  }\n\n  get template() {\n    return this._template\n  }\n\n  set template(value) {\n    this._template = value\n  }\n\n  get lang() {\n    return (!this._lang) ? 'en' : this._lang\n  }\n\n  set lang(value) {\n    value = value.toLowerCase()\n    if (!['en', 'fr'].includes(value)) throw new Error(`Wrong lang, please set 'en' or 'fr'`)\n    this._lang = value\n  }\n\n  get id() {\n    return this._id\n  }\n\n  set id(value) {\n    this._id = value\n  }\n\n  get order_reference_pattern() {\n    return (!this._order_reference_pattern) ? '$prefix{OR}$date{YYMM}$separator{-}$id{00000}' : this._order_reference_pattern\n  }\n\n  set order_reference_pattern(value) {\n    this._order_reference_pattern = value\n  }\n\n  get invoice_reference_pattern() {\n    return (!this._invoice_reference_pattern) ? '$prefix{IN}$date{YYMM}$separator{-}$id{00000}' : this._invoice_reference_pattern\n  }\n\n  set invoice_reference_pattern(value) {\n    this._invoice_reference_pattern = value\n  }\n\n  get reference() {\n    return this._reference\n  }\n\n  set reference(value) {\n    this._reference = value\n  }\n\n  get logo() {\n    return this._logo\n  }\n\n  set logo(value) {\n    this._logo = value\n  }\n\n  get order_template() {\n    return this._order_template\n  }\n\n  set order_template(value) {\n    this._order_template = value\n  }\n\n  get invoice_template() {\n    return this._invoice_template\n  }\n\n  set invoice_template(value) {\n    this._invoice_template = value\n  }\n\n  get order_note() {\n    return this._order_note\n  }\n\n  set order_note(value) {\n    this._order_note = value\n  }\n\n  get invoice_note() {\n    return this._invoice_note\n  }\n\n  set invoice_note(value) {\n    this._invoice_note = value\n  }\n\n  get footer() {\n    return this._footer\n  }\n\n  set footer(value) {\n    this._footer = value\n  }\n\n  get date_format() {\n    return (!this._date_format) ? 'YYYY/MM/DD' : this._date_format\n  }\n\n  set date_format(value) {\n    this._date_format = value\n  }\n\n  get date() {\n    return (!this._date) ? moment().format(this.date_format) : this._date\n  }\n\n  set date(value) {\n    if (!moment(value).isValid()) throw new Error(`Date not valid`)\n    this._date = moment(value).format(this.date_format)\n  }\n\n  get total_exc_taxes() {\n    return this._total_exc_taxes\n  }\n\n  set total_exc_taxes(value) {\n    this._total_exc_taxes = value\n  }\n\n  get total_taxes() {\n    return this._total_taxes\n  }\n\n  set total_taxes(value) {\n    this._total_taxes = value\n  }\n\n  get total_inc_taxes() {\n    return this._total_inc_taxes\n  }\n\n  set total_inc_taxes(value) {\n    this._total_inc_taxes = value\n  }\n\n  get article() {\n    return this._article\n  }\n\n  /**\n   * @description Set\n   * @param array || object\n   * @example article({description: 'Licence', tax: 20, price: 100, qt: 1})\n   * @example article([{description: 'Licence', tax: 20, price: 100, qt: 1}, {description: 'Licence', tax: 20, price: 100, qt: 1}])\n   */\n  set article(value) {\n    if (Array.isArray(value)) {\n      for (let i = 0; i < value.length; i++) {\n        this._checkArticle(value[i])\n        value[i].total_product_without_taxes = this.formatOutputNumber(value[i].price * value[i].qt)\n        value[i].total_product_taxes = this.formatOutputNumber(this.round(value[i].total_product_without_taxes * (value[i].tax / 100)))\n        value[i].total_product_with_taxes = this.formatOutputNumber(this.round(Number(value[i].total_product_without_taxes) + Number(value[i].total_product_taxes)))\n        value[i].price = this.formatOutputNumber(value[i].price)\n        value[i].tax = this.formatOutputNumber(value[i].tax)\n        this.total_exc_taxes += Number(value[i].total_product_without_taxes)\n        this.total_inc_taxes += Number(value[i].total_product_with_taxes)\n        this.total_taxes += Number(value[i].total_product_taxes)\n      }\n    } else {\n      this._checkArticle(value)\n      value.total_product_without_taxes = this.formatOutputNumber(value.price * value.qt)\n      value.total_product_taxes = this.formatOutputNumber(this.round(value.total_product_without_taxes * (value.tax / 100)))\n      value.total_product_with_taxes = this.formatOutputNumber(this.round(Number(value.total_product_without_taxes) + Number(value.total_product_taxes)))\n      value.price = this.formatOutputNumber(value.price)\n      value.tax = this.formatOutputNumber(value.tax)\n      this.total_exc_taxes += Number(value.total_product_without_taxes)\n      this.total_inc_taxes += Number(value.total_product_with_taxes)\n      this.total_taxes += Number(value.total_product_taxes)\n    }\n    this._article = (this._article) ? this._article.concat(value) : [].concat(value)\n  }\n\n  /**\n   * @description Reinitialize article attribute\n   */\n  deleteArticles() {\n    this._total_inc_taxes = 0\n    this._total_taxes = 0\n    this._total_exc_taxes = 0\n    this._article = []\n  }\n\n  /**\n   * @description Check article structure and data\n   * @param article\n   * @private\n   */\n  _checkArticle(article) {\n    if (!article.hasOwnProperty('description')) throw new Error(`Description is attribute is missing`)\n    if (!article.hasOwnProperty('tax')) throw new Error(`Tax attribute is missing`)\n    if (!this.isNumeric(article.tax)) throw new Error(`Tax attribute have to be a number`)\n    if (!article.hasOwnProperty('price')) throw new Error(`Price attribute is missing`)\n    if (!this.isNumeric(article.price)) throw new Error(`Price attribute have to be a number`)\n    if (!article.hasOwnProperty('qt')) throw new Error(`Qt attribute is missing`)\n    if (!this.isNumeric(article.qt)) throw new Error(`Qt attribute have to be an integer`)\n    if (!Number.isInteger(article.qt)) throw new Error(`Qt attribute have to be an integer, not a float`)\n  }\n\n  /**\n   * @description Hydrate from configuration\n   * @returns {[string,string,string,string]}\n   */\n  _itemsToHydrate() {\n    return ['logo', 'order_template', 'invoice_template', 'date_format', 'order_reference_pattern', 'invoice_reference_pattern', 'order_note', 'invoice_note', 'lang', 'footer']\n  }\n\n  /**\n   * @description Hydrate recipient object\n   * @param obj\n   * @returns {*}\n   */\n  recipient(obj) {\n    if (!obj) return this._recipient\n    return this._recipient.hydrate(obj, this._recipient._itemsToHydrate())\n  }\n\n  /**\n   * @description Hydrate emitter object\n   * @param obj\n   * @returns {*}\n   */\n  emitter(obj) {\n    if (!obj) return this._emitter\n    return this._emitter.hydrate(obj, this._emitter._itemsToHydrate())\n  }\n\n  /**\n   * @description Precompile translation to merging glabal with custom translations\n   * @returns {{logo: *, header_date: *, table_information, table_description, table_tax, table_quantity, table_price_without_taxes, table_price_without_taxes_unit, table_note, table_total_without_taxes, table_total_taxes, table_total_with_taxes, fromto_phone, fromto_mail, footer, moment: (*|moment.Moment)}}\n   * @private\n   */\n  _preCompileCommonTranslations() {\n    return {\n      logo: this.logo,\n      header_date: this.date,\n      table_information: i18n.__({phrase: 'table_information', locale: this.lang}),\n      table_description: i18n.__({phrase: 'table_description', locale: this.lang}),\n      table_tax: i18n.__({phrase: 'table_tax', locale: this.lang}),\n      table_quantity: i18n.__({phrase: 'table_quantity', locale: this.lang}),\n      table_price_without_taxes: i18n.__({phrase: 'table_price_without_taxes', locale: this.lang}),\n      table_price_without_taxes_unit: i18n.__({phrase: 'table_price_without_taxes_unit', locale: this.lang}),\n      table_note: i18n.__({phrase: 'table_note', locale: this.lang}),\n      table_total_without_taxes: i18n.__({phrase: 'table_total_without_taxes', locale: this.lang}),\n      table_total_taxes: i18n.__({phrase: 'table_total_taxes', locale: this.lang}),\n      table_total_with_taxes: i18n.__({phrase: 'table_total_with_taxes', locale: this.lang}),\n      fromto_phone: i18n.__({phrase: 'fromto_phone', locale: this.lang}),\n      fromto_mail: i18n.__({phrase: 'fromto_mail', locale: this.lang}),\n      footer: this.getFooter(),\n      emitter_name: this.emitter().name,\n      emitter_street_number: this.emitter().street_number,\n      emitter_street_name: this.emitter().street_name,\n      emitter_zip_code: this.emitter().zip_code,\n      emitter_city: this.emitter().city,\n      emitter_country: this.emitter().country,\n      emitter_phone: this.emitter().phone,\n      emitter_mail: this.emitter().mail,\n      recipient_company: this.recipient().company_name,\n      recipient_first_name: this.recipient().first_name,\n      recipient_last_name: this.recipient().last_name,\n      recipient_street_number: this.recipient().street_number,\n      recipient_street_name: this.recipient().street_name,\n      recipient_zip_code: this.recipient().zip_code,\n      recipient_city: this.recipient().city,\n      recipient_country: this.recipient().country,\n      recipient_phone: this.recipient().phone,\n      recipient_mail: this.recipient().mail,\n      articles: this.article,\n      table_total_without_taxes_value: this.formatOutputNumber(this.total_exc_taxes),\n      table_total_taxes_value: this.formatOutputNumber(this.total_taxes),\n      table_total_with_taxes_value: this.formatOutputNumber(this.total_inc_taxes),\n      template_configuration: this._templateConfiguration(),\n      moment: moment()\n    }\n  }\n\n  /**\n   * @description Compile pug template to HTML\n   * @param keys\n   * @returns {*}\n   * @private\n   */\n  _compile(keys) {\n    let template = keys.filename === 'order' ? this.order_template : this.invoice_template\n    let compiled = pug.compileFile(path.resolve(template))\n    return compiled(keys)\n  }\n\n  /**\n   * @description Return invoice translation keys object\n   * @returns {*}\n   */\n  getInvoice() {\n    let keys = {\n      invoice_header_title: i18n.__({phrase: 'invoice_header_title', locale: this.lang}),\n      invoice_header_subject: i18n.__({phrase: 'invoice_header_subject', locale: this.lang}),\n      invoice_header_reference: i18n.__({phrase: 'invoice_header_reference', locale: this.lang}),\n      invoice_header_reference_value: this.getReferenceFromPattern('invoice'),\n      invoice_header_date: i18n.__({phrase: 'invoice_header_date', locale: this.lang}),\n      table_note_content: this.invoice_note,\n      note: (note) => {\n        return (note) ? this.invoice_note = note : this.invoice_note\n      },\n      filename: 'invoice'\n    }\n    return Object.assign(keys, {\n      toHTML: () => this._toHTML(keys),\n      toPDF: () => this._toPDF(keys)\n    }, this._preCompileCommonTranslations())\n  }\n\n  /**\n   * @description Return order translation keys object\n   * @returns {*}\n   */\n  getOrder() {\n    let keys = {\n      order_header_title: i18n.__({phrase: 'order_header_title', locale: this.lang}),\n      order_header_subject: i18n.__({phrase: 'order_header_subject', locale: this.lang}),\n      order_header_reference: i18n.__({phrase: 'order_header_reference', locale: this.lang}),\n      order_header_reference_value: this.getReferenceFromPattern('order'),\n      order_header_date: i18n.__({phrase: 'order_header_date', locale: this.lang}),\n      table_note_content: this.order_note,\n      note: (note) => {\n        return (note) ? this.order_note = note : this.order_note\n      },\n      filename: 'order'\n    }\n    return Object.assign(keys, {\n      toHTML: () => this._toHTML(keys),\n      toPDF: () => this._toPDF(keys)\n    }, this._preCompileCommonTranslations())\n  }\n\n  /**\n   * @description Return right footer\n   * @returns {*}\n   */\n  getFooter() {\n    if (!this.footer) return i18n.__({phrase: 'footer', locale: this.lang})\n\n    if (this.lang === 'en') return this.footer.en\n    else if (this.lang === 'fr') return this.footer.fr\n    else throw Error(`This lang doesn't exist.`)\n  }\n\n  /**\n   * @description Return reference from pattern\n   * @param type\n   * @return {*}\n   */\n  getReferenceFromPattern(type) {\n    if (!['order', 'invoice'].includes(type)) throw new Error(`Type have to be \"order\" or \"invoice\"`)\n    if (this.reference) return this.reference\n    return this.setReferenceFromPattern((type === 'order') ? this.order_reference_pattern : this.invoice_reference_pattern)\n  }\n\n  /**\n   * @description Set reference\n   * @param item\n   * @return {*}\n   * @private\n   */\n  setReferenceFromPattern(pattern) {\n    let tmp = pattern.split('$').slice(1)\n    let output = ''\n    for (let item of tmp) {\n      if (!item.endsWith('}')) throw new Error(`Wrong pattern type`)\n      if (item.startsWith('prefix{')) output += item.replace('prefix{', '').slice(0, -1)\n      else if (item.startsWith('separator{')) output += item.replace('separator{', '').slice(0, -1)\n      else if (item.startsWith('date{')) output += moment().format(item.replace('date{', '').slice(0, -1))\n      else if (item.startsWith('id{')) {\n        const id = item.replace('id{', '').slice(0, -1)\n        if (!/^\\d+$/.test(id)) throw new Error(`Id must be an integer (${id})`)\n        output += (this._id) ? this.pad(this._id, id.length) : this.pad(0, id.length)\n      }\n      else throw new Error(`${item} pattern reference unknown`)\n    }\n    return output\n  }\n\n  /**\n   * @description Export object with html content and exportation functions\n   * @returns {{html: *, toFile: (function(*): *)}}\n   * @private\n   */\n  _toHTML(keys) {\n    const html = this._compile(keys.filename === 'order' ? this.getOrder() : this.getInvoice())\n    return {\n      html: html,\n      toFile: (filepath) => this._toFileFromHTML(html, (filepath) ? filepath : `${keys.filename}.html`)\n    }\n  }\n\n  /**\n   * @description Save content to pdf file\n   * @param filepath\n   * @returns {*}\n   * @private\n   */\n  _toPDF(keys) {\n    const pdf = htmlToPdf.create(this._toHTML(keys).html)\n    return {\n      pdf: pdf,\n      toFile: (filepath) => this._toFileFromPDF(pdf, (filepath) ? filepath : `${keys.filename}.pdf`),\n      toBuffer: (filepath) => this._toBufferFromPDF(pdf),\n      toStream: (filepath) => this._toStreamFromPDF(pdf, (filepath) ? filepath : `${keys.filename}.pdf`)\n    }\n  }\n\n  /**\n   * @description Save content into file from toHTML() method\n   * @param content\n   * @param filepath\n   * @returns {Promise}\n   * @private\n   */\n  _toFileFromHTML(content, filepath) {\n    return new Promise((resolve, reject) => {\n      return fs.writeFile(filepath, content, (err) => {\n        if (err) reject(err)\n        return resolve()\n      })\n    })\n  }\n\n  /**\n   * @description Save content into file from toPDF() method\n   * @param content\n   * @param filepath\n   * @returns {Promise}\n   * @private\n   */\n  _toFileFromPDF(content, filepath) {\n    return new Promise((resolve, reject) => {\n      return content.toFile(filepath, (err, res) => {\n        if (err) return reject(err)\n        return resolve(res)\n      })\n    })\n  }\n\n  /**\n   * @description Export PDF to buffer\n   * @param content\n   * @returns {*}\n   * @private\n   */\n  _toBufferFromPDF(content) {\n    return content.toBuffer((err, buffer) => {\n      if (err) return console.error(err)\n      return buffer\n    })\n  }\n\n  /**\n   * @description Export PDF to file using stream\n   * @param content\n   * @param filepath\n   * @returns {*}\n   * @private\n   */\n  _toStreamFromPDF(content, filepath) {\n    return content.toStream((err, stream) => {\n      return stream.pipe(fs.createWriteStream(filepath))\n    })\n  }\n\n  /**\n   * @description Calculates number of pages and items per page\n   * @return {{rows_in_first_page: number, rows_in_others_pages: number, loop_table: number}}\n   * @private\n   */\n  _templateConfiguration() {\n    let template_rows_per_page = 29\n    let templateConfig = {\n      rows_in_first_page: (this.article.length > 19) ? template_rows_per_page : 19,\n      rows_per_pages: 43,\n      rows_in_last_page: 33,\n    }\n\n    let nbArticles = this.article.length\n    let loop = 1\n    while (true) {\n\n      if (loop === 1) {\n        nbArticles -= templateConfig.rows_in_first_page\n        if (nbArticles <= 0) {\n          templateConfig.loop_table = (templateConfig.rows_in_first_page !== template_rows_per_page) ? 1 : 2\n          return templateConfig\n        }\n      }\n\n      if (loop >= 2) {\n        if (nbArticles <= templateConfig.rows_in_last_page) {\n          templateConfig.loop_table = loop\n          return templateConfig\n        } else {\n          nbArticles -= templateConfig.rows_per_pages\n          if (nbArticles <= 0) {\n            templateConfig.loop_table = loop\n            return templateConfig\n          }\n        }\n      }\n      loop++\n    }\n  }\n\n}\n"],"sourceRoot":"/Users/dimitri/repositories/invoice-generator/src"}